---
title: Git jest git
author: Michał Bojanowski
output:
  html_document:
    toc: true
    self_contained: true
---

```{r, check_commands, results="hide", echo=FALSE}
# check if necessary commands are present
cmd <- c("bash", "sh", "git")
r <- sapply(cmd, Sys.which)
empty <- r == ""
if( any(empty) ) 
  stop(paste("some commands are not available: ", paste(cmd[empty], collapse=", ")))

library(knitr) # dev version
pr <- function(user=NULL) {
  u <- if(is.null(user)) "" else paste0(user, ":")
  paste0("PS4=", u, sQuote('$(pwd | sed s/^.*gitjestgit/./)\\$ ') )
}

opts_chunk$set(engine="bash", comment="", engine.env=pr(), echo=FALSE,
               comment=NA, engine.opts="-x")
```





```{r, file_contents, engine="R"}
plik1 <- "Wpadła gruszka do fartuszka, 
A za gruszką dwa jabłuszka, 
Lecz śliweczka wpaść nie chciała, 
Bo śliweczka niedojrzała.

Przepisujemy:
"

plik2 <- " Idzie kominiarz 
Po drabinie, 
Fiku miku, 
Już w kominie!

Przepisujemy:
"
```






# Wstęp

Praca z git bash.

## Narzędzia

- Zainstalować `git`. (git bash)
- Przydatne aliasy (skróty) dla `git`
  - oglądanie historii

## Źródła

- Książka o gicie





# Repozytorium

Symulacja githuba.

Główne repozytorium projektu na GitHubie.

```{r, create_projekt_bare}
git init --bare projekt.git
git clone projekt.git
cd projekt
git config user.name szef
git config user.email szef@korpo.com
```


```{r, zapisz_pliki, engine="R"}
cat(plik1, file="projekt/plik1.txt")
cat(plik2, file="projekt/plik2.txt")
```


```{r}
git add plik1.txt plik2.txt
git commit -m "Pierwsze wersje plików"
echo "Wpadła gruszka do fartuszka" >> plik1.txt
git commit -am "Wers o gruszce"
echo "Idzie kominiarz" >> plik2.txt
git commit -am "kominiarz"
git push origin master
cd ..
rm -rf projekt
```





# Praca w pojedynke

Klonujemy za pomocą URL ze strony github.

```
git clone projekt.git
# Przy pracy z Github  `projekt.git` wstawiamy odpowiedni URL.
# Powstanie folder `projekt` zawierający następujące pliki:
cd projekt
ls projekt

# 1. edytujemy i zapisujemy
echo "Moja edycja" >> plik1.txt

# 2. komitujemy
git add plik1.txt
git commit -m "Zmieniłem plik1.txt"

# 3. wróc do 1., i tak dalej...
```

Dobre praktyki komitowania:

- Lepiej częściej niż rzadziej.
- Jeżeli to możliwe, i ma sens, komit powinien być jakąś logiczną całością.
- ...

W odpowiednim momencie (gdy zmiany mają być widoczne dla innych, na koniec dnia, etc.)
wypychamy ("push") nasze zmiany z lokalnego repozytorium "upstream", czyli do repozytorium,
które sklonowaliśmy. W tym przypadku `projekt.git`.

```
git push origin
```



# Zespołowo: fork & pull request




# FAQ







## Rebase publicznego brancha?

Mamy repo `projekt.git`.

Na github robimy forka. Niech nazywa się `fork-pracownik.git`

```{r, fake_fork}
git init --bare fork-pracownik.git
git clone projekt.git
cd projekt
git remote add fork ../fork-pracownik.git
git push fork master
cd ..
rm -rf projekt
```

Klonujemy forka. robimy brancha i pracujemy na nim.


```{r, engine.env=pr("pracownik")}
git clone fork-pracownik.git pracownik
```

```{r}
cd pracownik
git config user.name pracownik
```



```{r, engine.env=pr("pracownik")}
cd pracownik
git checkout -b gruszka
echo "A za gruszką dwa jabłuszka," >> plik1.txt
git add plik1.txt
git commit -m "jabłuszka"
echo "Lecz śliweczka wpaść nie chicała" >> plik1.txt
git add plik1.txt
git commit -m "śliweczka"

#
git lgm
```

W między czasie szef pracował na masterze.


```{r, engine.env=pr("szef")}
git clone projekt.git projekt-szef
cd projekt-szef
echo "Po drabinie," >> plik2.txt
git add plik2.txt
git commit -m "drabina"
echo "Fiku muku," >> plik2.txt
git add plik2.txt
git commit -m "fikumiku"
git push origin master

git lgm
```

Pracownik chce włączyć swoje zmiany do `master`. W tym celu aktualizuje swoje lokalne repo

```{r, engine.env=pr("pracownik")}
cd pracownik
git remote add upstream ../projekt.git
git fetch upstream
# update lokalnego mastera
git checkout master
git pull upstream master
git lgm
```

Gałęzie `upstream/master` i `mojezmiany` się rozgałęziają.

Przepisujemy zmiany w `mojezmiany` nad `upstream/master`

```
cd pracownik
git checkout mojezmiany
git rebase master
```



